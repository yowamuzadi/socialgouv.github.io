(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{OrIB:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/actus/tests-navigateur-avec-cypress",function(){return a("Phl6")}])},Phl6:function(e,t,a){"use strict";a.r(t),a.d(t,"meta",function(){return i}),a.d(t,"default",function(){return m});var s=a("kOwS"),n=a("qNsG"),c=a("q1tI"),r=a.n(c),l=a("E/Ix"),o=a("tKWW"),i=(r.a.createElement,{title:"Tests de navigateur automatis\xe9s avec cypress.io",hero:{background:"/static/images/actus/cypress.io/tim-foster-242021-unsplash.jpg",alt:"Photo by Tim Foster"}}),p={meta:i},u="wrapper";function m(e){var t=e.components,a=Object(n.a)(e,["components"]);return Object(l.a)(u,Object(s.a)({},p,a,{components:t,mdxType:"MDXLayout"}),Object(l.a)(o.k,{meta:i,mdxType:"LayoutArticle"},Object(l.a)("h1",null,'Automatisation des tests navigateurs ("e2e")'),Object(l.a)("p",null,"Que ce soit pour ",Object(l.a)("strong",{parentName:"p"},"emp\xeacher les r\xe9gressions")," fonctionnelles, tester de nouvelles impl\xe9mentations ou ",Object(l.a)("strong",{parentName:"p"},"gagner du temps en recette"),", les tests automatis\xe9s sont un outil pr\xe9cieux pour fiabiliser les applications web."),Object(l.a)("p",null,"Ce type de test, ",Object(l.a)("strong",{parentName:"p"},"en compl\xe9ment des code reviews et des tests unitaires"),", permet de detecter les bugs le plus t\xf4t possible, avant qu'ils n'atteignent la production, ce qui offre potentiellement un meilleur service aux usagers tout en permettant des \xe9conomies sur les co\xfbts des correctifs."),Object(l.a)("p",null,"En effet, le co\xfbt de correction d'un bug augmente de mani\xe8re exponentielle avec le temps."),Object(l.a)("br",null),Object(l.a)("p",null,Object(l.a)("img",Object(s.a)({parentName:"p"},{src:"/static/images/actus/cypress.io/defect-costs.jpg",alt:"le co\xfbt des bugs"}))),Object(l.a)("br",null),Object(l.a)("p",null,"En plus de fiabiliser une application, ce type de test offre d'autres vertues : augmenter la confiance technique, et ainsi permettre aux d\xe9veloppeurs(ses) de pouvoir refactorer le code ",Object(l.a)("strong",{parentName:"p"},"sans avoir peur de casser quelque chose"),"."),Object(l.a)("blockquote",null,Object(l.a)("p",{parentName:"blockquote"},"La maintenance n'est pas un probl\xe8me mais une solution  ",Object(l.a)("a",Object(s.a)({parentName:"p"},{href:"http://twitter.com/f_leguedois",title:"@f_leguedois"}),"\xa9"))),Object(l.a)("p",null,"Cette maintenance pr\xe9ventive, toujours n\xe9cessaire mais trop souvent mise de c\xf4t\xe9, permet d'allonger la dur\xe9e de vie des applications en maintenant un niveau de qualit\xe9 \xe9lev\xe9, ce qui permettra de mieux absorber les changements in\xe9vitables de tout projet num\xe9rique."),Object(l.a)("h2",null,"cypress.io"),Object(l.a)("p",null,"Dans cet article, nous vous pr\xe9sentons ",Object(l.a)("a",Object(s.a)({parentName:"p"},{href:"http://cypress.io"}),"cypress.io"),", un outil open-source qui permet de piloter les navigateurs web Chrome/Canary/Chromium, d'executer des sc\xe9narios complexes, de faire des mesures, et de remonter les anomalies."),Object(l.a)("p",null,"L'outil peut-\xeatre utilis\xe9 en local, pendant le d\xe9veloppement ou la recette, ou sur une infrastructure d\xe9di\xe9e, dans le cadre de l'int\xe9gration continue : chaque changement sur le code red\xe9clenche alors touts les tests avant un \xe9ventuel d\xe9ploiement."),Object(l.a)("blockquote",null,Object(l.a)("p",{parentName:"blockquote"},"\u26a0\ufe0f Contrairement \xe0 d'autres solutions comme ",Object(l.a)("a",Object(s.a)({parentName:"p"},{href:"https://www.seleniumhq.org/"}),"Selenium")," ou ",Object(l.a)("a",Object(s.a)({parentName:"p"},{href:"https://saucelabs.com"}),"SauceLabs"),", Cypress ne fonctionne qu'avec des navigateurs \xe0 base de Chromium.")),Object(l.a)("h3",null,"Donc pourquoi utiliser cypress.io ?"),Object(l.a)("p",null,"Cypress permet de coder vos sc\xe9narios en JavaScript, un language accessible \xe0 tous et est ",Object(l.a)("a",Object(s.a)({parentName:"p"},{href:"https://github.com/cypress-io/cypress/"}),"disponible sur GitHub")," avec une grande communaut\xe9 et une ",Object(l.a)("a",Object(s.a)({parentName:"p"},{href:"https://docs.cypress.io/"}),"tr\xe8s bonne documentation"),"."),Object(l.a)("p",null,"Cypress donne \xe9galement acc\xe8s \xe0 la couche r\xe9seau du navigateur et permet de faire des captures d'\xe9cran ou vid\xe9o des s\xe9quences de test."),Object(l.a)("p",null,"L'experience utilisateur lors de la cr\xe9ation des tests est bluffante, l'",Object(l.a)("a",Object(s.a)({parentName:"p"},{href:"https://docs.cypress.io/api/introduction/api.html"}),"API tr\xe8s compl\xe8te")," et de nombreux d\xe9tails ont \xe9t\xe9 pens\xe9s pour permettre d'\xe9crire et d'executer les tests tr\xe8s rapidement. ",Object(l.a)("a",Object(s.a)({parentName:"p"},{href:"https://twitter.com/search?q=%23LittleBigDetails"}),"#LittleBigDetails")),Object(l.a)("p",null,"D\xe9mo en 2 minutes :"),Object(l.a)("iframe",{src:"https://player.vimeo.com/video/237527670?title=0&byline=0&portrait=0",width:"640",height:"360",frameBorder:"0",webkitAllowFullscreen:!0,mozAllowFullscreen:!0,allowFullScreen:!0}),Object(l.a)("h2",null,"Mise en oeuvre"),Object(l.a)("p",null,"Pour d\xe9marrer, le plus simple est d'utiliser l'installeur officiel sur ",Object(l.a)("a",Object(s.a)({parentName:"p"},{href:"https://www.cypress.io/"}),"cypress.io"),"."),Object(l.a)("p",null,"Vous devez installer NodeJS et npm sur votre poste et ",Object(l.a)("a",Object(s.a)({parentName:"p"},{href:"https://docs.cypress.io/guides/getting-started/installing-cypress.html"}),"suivre le quickstart"),"."),Object(l.a)("p",null,"Dans votre projet, cr\xe9ez un fichier dans ",Object(l.a)("inlineCode",{parentName:"p"},"./cypress/integration/test1.spec.js"),"."),Object(l.a)("p",null,"Coller le code suivant, c'est un exemple de base pour d\xe9marrer."),Object(l.a)("pre",null,Object(l.a)("code",Object(s.a)({parentName:"pre"},{className:"hljs language-js"}),Object(l.a)("span",Object(s.a)({parentName:"code"},{className:"hljs-comment"}),"// exemple simpliste de test navigateur"),"\ndescribe(",Object(l.a)("span",Object(s.a)({parentName:"code"},{className:"hljs-string"}),'"L\'utilisateur peut acc\xe9der \xe0 une convention collective"'),", () => {\n  it.only(",Object(l.a)("span",Object(s.a)({parentName:"code"},{className:"hljs-string"}),'"Recherche de la CCN #843"'),", () => {\n    ",Object(l.a)("span",Object(s.a)({parentName:"code"},{className:"hljs-comment"}),"// va sur la page de recherche legifrance"),"\n    cy.visit(",Object(l.a)("span",Object(s.a)({parentName:"code"},{className:"hljs-string"}),'"http://www.legifrance.gouv.fr/initRechConvColl.do"'),");\n\n    ",Object(l.a)("span",Object(s.a)({parentName:"code"},{className:"hljs-comment"}),'//remplis le champ "IDCC" avec "843"'),"\n    cy.get(",Object(l.a)("span",Object(s.a)({parentName:"code"},{className:"hljs-string"}),'"#champ3"'),").type(",Object(l.a)("span",Object(s.a)({parentName:"code"},{className:"hljs-string"}),'"843"'),");\n\n    ",Object(l.a)("span",Object(s.a)({parentName:"code"},{className:"hljs-comment"}),"// lances la recherche"),"\n    cy.get(",Object(l.a)("span",Object(s.a)({parentName:"code"},{className:"hljs-string"}),"'input[value=\"Rechercher\"]'"),").click();\n\n    ",Object(l.a)("span",Object(s.a)({parentName:"code"},{className:"hljs-comment"}),"// v\xe9rifies qu'on a bien un r\xe9sultat"),"\n    cy.get(",Object(l.a)("span",Object(s.a)({parentName:"code"},{className:"hljs-string"}),'"li.resultat1"'),").should(",Object(l.a)("span",Object(s.a)({parentName:"code"},{className:"hljs-string"}),'"have.length"'),", ",Object(l.a)("span",Object(s.a)({parentName:"code"},{className:"hljs-number"}),"1"),");\n\n    ",Object(l.a)("span",Object(s.a)({parentName:"code"},{className:"hljs-comment"}),"// visite l'url du lien trouv\xe9"),"\n    cy\n      .get(",Object(l.a)("span",Object(s.a)({parentName:"code"},{className:"hljs-string"}),'"li.resultat1 a"'),")\n      .then(",Object(l.a)("span",Object(s.a)({parentName:"code"},{className:"hljs-function"}),Object(l.a)("span",Object(s.a)({parentName:"span"},{className:"hljs-params"}),"node")," =>")," cy.visit(node[",Object(l.a)("span",Object(s.a)({parentName:"code"},{className:"hljs-number"}),"0"),"].href))\n      ",Object(l.a)("span",Object(s.a)({parentName:"code"},{className:"hljs-comment"}),"// verifies qu'on a 178 liens (annexes)"),"\n      .then(",Object(l.a)("span",Object(s.a)({parentName:"code"},{className:"hljs-function"}),Object(l.a)("span",Object(s.a)({parentName:"span"},{className:"hljs-params"}),"()")," =>")," cy.get(",Object(l.a)("span",Object(s.a)({parentName:"code"},{className:"hljs-string"}),'"ul.lien_texte li"'),").should(",Object(l.a)("span",Object(s.a)({parentName:"code"},{className:"hljs-string"}),'"have.length"'),", ",Object(l.a)("span",Object(s.a)({parentName:"code"},{className:"hljs-number"}),"178"),"))\n\n});")),Object(l.a)("p",null,"Comme vous pouvez le voir, on se base sur les ",Object(l.a)("a",Object(s.a)({parentName:"p"},{href:"https://developer.mozilla.org/fr/docs/Web/CSS/S%C3%A9lecteurs_CSS"}),"selecteurs CSS")," pour cibler pr\xe9cis\xe9ment les \xe9l\xe9ments de la page \xe0 tester. L'",Object(l.a)("a",Object(s.a)({parentName:"p"},{href:"https://docs.cypress.io/api/introduction/api.html"}),"API de cypress")," permet ensuite de d\xe9clencher des actions comme ",Object(l.a)("inlineCode",{parentName:"p"},"visit()"),", ",Object(l.a)("inlineCode",{parentName:"p"},"type()"),", ",Object(l.a)("inlineCode",{parentName:"p"},"click()")," et de d\xe9finir des assertions(",Object(l.a)("inlineCode",{parentName:"p"},"should"),") qui d\xe9finissent les conditions de validit\xe9 de notre test."),Object(l.a)("p",null,"Ensuite, depuis le repertoire de votre projet, lancez ",Object(l.a)("inlineCode",{parentName:"p"},"./node_modules/.bin/cypress open")),Object(l.a)("p",null,"Les tests vont alors s'executer dans une fen\xeatre Chrome d\xe9di\xe9e :"),Object(l.a)("p",null,Object(l.a)("img",Object(s.a)({parentName:"p"},{src:"/static/images/actus/cypress.io/screenshot-legifrance.jpg",alt:"cypress en action"}))),Object(l.a)("p",null,"Cette interface permet de v\xe9rifier le bon d\xe9roulement des tests et la validit\xe9 des selecteurs CSS. D\xe8s que vous modifiez un test, il se relancera automatiquement."),Object(l.a)("p",null,"Compl\xe9tez ensuite votre suite de test pour couvrir les sc\xe9narios critiques de votre application."),Object(l.a)("h2",null,"Industrialisation"),Object(l.a)("p",null,"Une fois vos tests op\xe9rationnels, vous pouvez les int\xe9grer dans une chaine d'int\xe9gration continue, avec CircleCI, travis, ou GitLab CI par exemple. Chaque modification sur le projet entrainera alors automatiquement l'execution des tests."),Object(l.a)("p",null,"Cette automatisation entraine d'autre probl\xe9matiques : nos tests doivent tourner dans un environnement pr\xe9dictible, et si notre application fait appel \xe0 une API et une base de donn\xe9es, alors nous devons \xeatre capable soit de restaurer \xe0 la demande des jeux de donn\xe9es de test (les ",Object(l.a)("inlineCode",{parentName:"p"},"fixtures"),"), soit de ",Object(l.a)("inlineCode",{parentName:"p"},"stubber")," (intercepter) les requ\xeates API pour les remplacer par des donn\xe9es de test."),Object(l.a)("p",null,"C'est au prix de cet effort d'automatisation qui ramm\xe8ne de la confiance que nous pourrons rendre nos applications replicables, aller vers des ",Object(l.a)("strong",{parentName:"p"},"processus DevOps")," et avoir le s\xe9r\xe9nit\xe9 n\xe9cessaire pour faire du d\xe9ploiement continu."),Object(l.a)("h2",null,"Astuces"),Object(l.a)("p",null,"[todo]"),Object(l.a)("h2",null,"Conclusion"),Object(l.a)("p",null,"[todo]")))}m.isMDXComponent=!0}},[["OrIB",1,0]]]);